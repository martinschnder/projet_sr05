<!DOCTYPE html>
<html>

<body>
    <h2>Connection websocket</h2>
    <form>
        <p>
            <button id="connecter">Connecter</button>
            <button id="fermer">Fermer</button>
            host : <input id="host" type="text" size="10" value="localhost">
            port : <input id="port" type="text" maxlength="5" size="5" value="4444">
        </p>
    </form>
    <hr>
    <h2>Application</h2>
    <form>
        <p>
            <button id="envoyer">Envoyer</button>
            message : <input id="msg" type="text" value="Hello world!">
            horloge : <span id="hlg"></span>
        </p>
    </form>
    <hr>
    <h2>Logs</h2>
    <div id="logs" style="max-height: 40vh;overflow-y: scroll;"></div>
    <script>
        var ws;

        document.getElementById("connecter").onclick = function (evt) {
            if (ws) {
                return false;
            }

            var host = document.getElementById("host").value;
            var port = document.getElementById("port").value;

            addToLog("Tentative de connexion")
            addToLog("host = " + host + ", port = " + port)
            ws = new WebSocket("ws://" + host + ":" + port + "/ws");

            ws.onopen = function (evt) {
                addToLog("Websocket ouverte");
            }

            ws.onclose = function (evt) {
                addToLog("Websocket fermée");
                ws = null;
            }

            ws.onmessage = function (evt) {
                addToLog("Réception: " + evt.data);
                document.getElementById("hlg").innerHTML = evt.data
            }

            ws.onerror = function (evt) {
                addToLog("Erreur: " + evt.data);
            }
            return false;
        }

        document.getElementById("fermer").onclick = function (evt) {
            if (!ws) {
                return false;
            }
            ws.close();
            return false;
        }

        document.getElementById("envoyer").onclick = function (evt) {
            if (!ws) {
                return false;
            }
            var sndmsg = document.getElementById("msg").value;
            addToLog("Envoi: " + sndmsg);
            ws.send(sndmsg);
            return false;
        }

        function addToLog(message) {
            var logs = document.getElementById("logs");
            var d = document.createElement("div");
            d.textContent = message;
            logs.appendChild(d);
            logs.scroll(0, logs.scrollHeight);
        }
    </script>
</body>

</html>