<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Co-Write On Time</title>
    <link rel="stylesheet" href="client.css" />
</head>

<body>
    <div class="container">
        <div class="main">
            <h2>Connection websocket</h2>
            <form>
                <div class="form-container">
                    <fieldset class="fieldset-host">
                        <label for="host">HOST</label>
                        <input id="host" type="text" size="10" value="localhost">
                    </fieldset>
                    <fieldset class="fieldset-port">
                        <label for="port">PORT</label>
                        <input id="port" type="text" maxlength="5" size="5" value="4444">
                    </fieldset>
                    <div class="button-container">
                        <button class="btn-color" id="connecter">Connecter</button>
                        <button class="btn-color" id="fermer">Fermer</button>
                    </div>
                </div>
            </form>
            <div class="edit-content">
                <h2>Application</h2>
                <form>
                    <div class="form-container">
                        <fieldset class="fieldset-message">
                            <label for="message">Message</label>
                            <input id="msg" type="text" value="Hello world!">
                        </fieldset>
                        <div class="button-container">
                            <button class="btn-color" id="envoyer">Envoyer</button>
                        </div>
                    </div>
                </form>
                <div class="editor" id="editor"></div>
            </div>
        </div>
        <div class="logs">
            <h2>Logs</h2>
            <div class="horloge">
                Horloge : <span id="hlg"></span>
            </div>
            <div id="text-logs"></div>
        </div>
    </div>

    <script>
        var ws;

        document.getElementById("connecter").onclick = function (evt) {
            if (ws) {
                return false;
            }

            var host = document.getElementById("host").value;
            var port = document.getElementById("port").value;

            addToLog("Tentative de connexion")
            addToLog("host = " + host + ", port = " + port)
            ws = new WebSocket("ws://" + host + ":" + port + "/ws");

            ws.onopen = function (evt) {
                addToLog("Websocket ouverte");
            }

            ws.onclose = function (evt) {
                addToLog("Websocket fermée");
                ws = null;
            }

            ws.onmessage = function (evt) {
                addToLog("Réception: " + evt.data);
                document.getElementById("hlg").innerHTML = evt.data
            }

            ws.onerror = function (evt) {
                addToLog("Erreur: " + evt.data);
            }
            return false;
        }

        document.getElementById("fermer").onclick = function (evt) {
            if (!ws) {
                return false;
            }
            ws.close();
            return false;
        }

        document.getElementById("envoyer").onclick = function (evt) {
            if (!ws) {
                return false;
            }
            var sndmsg = document.getElementById("msg").value;
            addToLog("Envoi: " + sndmsg);
            ws.send(sndmsg);
            return false;
        }

        function addToLog(message) {
            var logs = document.getElementById("text-logs");
            var d = document.createElement("div");
            d.textContent = message;
            logs.appendChild(d);
            logs.scroll(0, logs.scrollHeight);
        }
    </script>
</body>

</html>